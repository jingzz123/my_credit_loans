<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="cn.creditloans.core.dao.P2PDbxxDao">
	<resultMap type="cn.creditloans.core.entity.p2p.P2PDbxx" id="p2pDbxxResultMap">
		<id property="id" column="id" />
		<result property="dbrxm" column="dbrxm"/>
		<result property="dbrzjlx" column="dbrzjlx"/>
		<result property="dbrzjhm" column="dbrzjhm"/>
		<result property="dbje" column="dbje"/>
		<result property="dbzt" column="dbzt"/>
		<result property="dkjbxxId" column="dkjbxx_id"/>
		<result property="status" column="status"/>
		<result property="userId" column="user_id"/>
		<result property="orgCode" column="org_code"/>
		<result property="createTime" column="create_time"/>
		<result property="updateTime" column="update_time"/>
	</resultMap>
	
	<sql id="select_all_sql">
		select id, dbrxm, dbrzjlx, dbrzjhm, dbje, dbzt, dkjbxx_id, status, user_id, org_code, create_time, update_time from p2p_dbxx
	</sql>
	
	<select id="selectP2PDbxxPageCount" parameterType="cn.creditloans.core.entity.p2p.P2PDbxx" resultType="int">
		select count(1) from p2p_dbxx where org_code = #{orgCode} and dkjbxx_id = #{dkjbxxId}
		<if test="dbrxm != null and '' != dbrxm">  
			and dbrxm like '%${dbrxm}%'
		</if>
		<if test="dbrzjhm != null and '' != dbrzjhm">  
			and dbrzjhm like '%${dbrzjhm}%'
		</if>
		<if test="status != 0">  
			and status = #{status}
		</if>
	</select>
	
	<select id="selectP2PDbxxPageList" resultMap="p2pDbxxResultMap">
		<include refid="select_all_sql" />
		where org_code = #{p2pDbxx.orgCode} and dkjbxx_id = #{p2pDbxx.dkjbxxId}
		<if test="p2pDbxx.dbrxm != null and '' != p2pDbxx.dbrxm">  
			and dbrxm like '%${p2pDbxx.dbrxm}%'
		</if>
		<if test="p2pDbxx.dbrzjhm != null and '' != p2pDbxx.dbrzjhm">  
			and dbrzjhm like '%${p2pDbxx.dbrzjhm}%'
		</if>
		<if test="p2pDbxx.status != 0">  
			and status = #{p2pDbxx.status}
		</if>
		order by create_time desc limit #{pm.pageSize} offset #{pm.startCount}
	</select>
	
	<select id="selectP2PDbxxById" parameterType="int" resultMap="p2pDbxxResultMap">
		<include refid="select_all_sql" />
		where id = #{id}
	</select>
	
	<select id="selectP2PDbxxCountForUnique" parameterType="map" resultType="int">
		select count(1) from p2p_dbxx where dbrzjlx = #{dbrzjlx} and dbrzjhm = #{dbrzjhm} and dkjbxx_id = #{dkjbxxId} and org_code = #{orgCode}
	</select>
	
	<insert id="insertP2PDbxx" parameterType="cn.creditloans.core.entity.p2p.P2PDbxx">
		<selectKey order="AFTER" keyProperty="id" resultType="java.lang.Integer">
			SELECT currval('p2p_dbxx_id_seq')
		</selectKey>
		insert into p2p_dbxx (dbrxm, dbrzjlx, dbrzjhm, dbje, dbzt, dkjbxx_id,
		status, user_id, org_code, create_time, update_time)
		values (#{dbrxm}, #{dbrzjlx}, #{dbrzjhm}, #{dbje}, #{dbzt}, #{dkjbxxId},
		#{status}, #{userId}, #{orgCode}, now(), now())
	</insert>
	
	<update id="updateP2PDbxx" parameterType="cn.creditloans.core.entity.p2p.P2PDbxx">
		update p2p_dbxx set dbrxm=#{dbrxm}, dbrzjlx=#{dbrzjlx}, dbrzjhm=#{dbrzjhm},
		dbje=#{dbje}, dbzt=#{dbzt}, dkjbxx_id=#{dkjbxxId}, status=#{status},
		user_id=#{userId}, org_code=#{orgCode}, update_time=now() where id=#{id}
	</update>
	
	<delete id="deleteP2PDbxxById" parameterType="int">
		delete from p2p_dbxx where id=#{id}
	</delete>
</mapper>