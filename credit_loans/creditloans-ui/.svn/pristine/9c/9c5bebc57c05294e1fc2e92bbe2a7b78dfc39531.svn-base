<%@ page language="java" contentType="text/html; charset=utf-8"
    pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>   
<%@ include  file="./../../common/header.jsp"%>
<!-- 二级菜单 begin -->
<div class="sidebar" id="sidebar">
	<div class="sidebar-shortcuts" id="sidebar-shortcuts">
		<div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
			<div class="icon-text">
				<i class="icon-group"></i> <span> 权限管理 </span>
			</div>
		</div>
	</div>
	<!-- #sidebar-shortcuts -->
	<ul class="nav nav-list">
		<li class="active"> <a href="${pageContext.request.contextPath}/subsidiary/info/enterpriseInfoList"> <i class="icon-th"></i> <span class="menu-text"> 企业信息管理 </span> </a> </li>
		<li> <a href="${pageContext.request.contextPath}/enterprise/dept/enterpriseDepartList"> <i class="icon-sitemap"></i> <span class="menu-text">部门信息管理</span> </a> </li>
		<li> <a href="${pageContext.request.contextPath}/enterprise/role/showList"> <i class="icon-star"></i> <span class="menu-text"> 角色管理 </span> </a> </li>
		<li> <a href="${pageContext.request.contextPath}/enterprise/user/showList"> <i class="icon-user"></i> <span class="menu-text"> 用户管理 </span> </a> </li>				
	</ul>
	<!-- /.nav-list -->
	<div class="sidebar-collapse" id="sidebar-collapse">
		<i class="icon-double-angle-left" data-icon1="icon-double-angle-left"
			data-icon2="icon-double-angle-right"></i>
	</div>
</div>
<!-- 二级菜单 end -->  
<div class="main-content">
	<div class="breadcrumbs" id="breadcrumbs">
	    <ul class="breadcrumb">
		    <li><i class="icon-home home-icon"></i> <a href="#">首页</a></li>
			<li class="active">企业信息</li>
			<li class="active">企业信息添加</li>
		</ul>
	</div>
	<div class="page-content">
	   <div class="page-header">
		    <h1>
				企业信息
				<small> 
				    <i class="icon-double-angle-right"></i>添加企业信息
				</small>
			</h1>
		</div><!-- /.page-header -->
		<div class="row">
		    <div class="col-xs-12">
			    <div class="col-md-12">
				    <form id="enterpriseInfo" class="form-horizontal" >
				        <div class="form-group">
						    <label for="name" class="col-sm-3 control-label">企业名称：</label>
							<div class="col-sm-4">
						    	<input type="text" id="name" name="name" class="form-control" placeholder="..企业名称" value="${enterprise.name}" />
						    	<input type="hidden"  id="strId" name="strId" value="${enterprise.id}">
							</div>
						    <span id="error_name" style="color: red"></span>
						</div>
						<div class="form-group">
						    <label for="name" class="col-sm-3 control-label">企业类型：</label>
							<div class="col-sm-4">
							<select class="form-control" id="typeId" name="typeId" >
								 <option>---请选择企业类型---</option>
								 <c:forEach items="${enterpriseTypes }" var="enterpriseType"  varStatus="status">
								 	 <c:if test="${enterpriseType.id != enterprise.typeId}">
								 	 	<option value="${enterpriseType.id}">${enterpriseType.name } </option>
								 	 </c:if>	
								 	 <c:if test="${enterpriseType.id == enterprise.typeId}">
								         <option value="${enterpriseType.id}" selected="selected">${enterpriseType.name } </option>
								     </c:if>
								 </c:forEach>
							</select>
							</div>
						    <span id="error_type_id" style="color: red"></span>
						</div>
						<div class="form-group">
						    <label for="name" class="col-sm-3 control-label">上级企业名称：</label>
							<div class="col-sm-4">
								<input type="text" name="" value="${enterprises.name }" class="form-control"  readonly="readonly" />
								<input type="hidden" id="fid" name="fid" value="${enterprises.id}"/>
							<%-- <select class="form-control" id="fid" name="fid" >
								 <option>---上级企业名称---</option>
								 <c:forEach items="${enterprises }" var="enter"  varStatus="status">
								 	 <c:if test="${enter.id != enterprise.fid  && enter.id != enterprise.id}">
								        <option value="${enter.id}">${enter.name } </option>
								     </c:if>
								     <c:if test="${enter.id == enterprise.fid}">
								        <option value="${enter.id}" selected="selected">${enter.name } </option>
								     </c:if>
								 </c:forEach>
							</select> --%>
							</div>
						    <span id="error_type_id" style="color: red"></span>
						</div>
						<div class="form-group">
						    <label for="name" class="col-sm-3 control-label">企业电话：</label>
							<div class="col-sm-4">
						    	<input type="text" id="tel" name="tel" class="form-control" placeholder="..企业电话" value="${enterprise.tel}" />
							</div>
						    <span id="error_tel" style="color: red"></span>
						</div>
						<div class="form-group">
						    <label for="name" class="col-sm-3 control-label">传真：</label>
							<div class="col-sm-4">
						    	<input type="text" id="fax" name="fax" class="form-control" placeholder="..企业传真" value="${enterprise.fax}" />
							</div>
						    <span id="error_fax" style="color: red"></span>
						</div>
						<div class="form-group">
						    <label for="name" class="col-sm-3 control-label">邮政编码：</label>
							<div class="col-sm-4">
						    	<input type="text" id="postcode" name="postcode" class="form-control" placeholder="..邮政编码" value="${enterprise.postcode}" />
							</div>
						    <span id="error_postcode" style="color: red"></span>
						</div>
					    <div class="form-group">
						    <label for="name" class="col-sm-3 control-label">电子邮箱：</label>
							<div class="col-sm-4">
						    	<input type="text" id="email" name="email" class="form-control" placeholder="..XXX@sina.com" value="${enterprise.email}" />
							</div>
						    <span id="error_email" style="color: red"></span>
						</div>
						<div class="form-group">
						    <label for="name" class="col-sm-3 control-label">企业地址：</label>
							<div class="col-sm-4">
						    	<input type="text" id="address" name="address" class="form-control" placeholder="..企业地址" value="${enterprise.address}" />
							</div>
						    <span id="error_address" style="color: red"></span>
						</div>
						<div class="form-group">
						    <label for="name" class="col-sm-3 control-label">网址：</label>
							<div class="col-sm-4">
						    	<input type="text" id="website" name="website" class="form-control" placeholder="..http://www.baidu.com" value="${enterprise.website}" />
							</div>
						    <span id="error_website" style="color: red"></span>
						</div>
						<div class="form-group">
						    <label for="name" class="col-sm-3 control-label">企业编号：</label>
							<div class="col-sm-4">
						    	<input type="text" id="code" name="code" class="form-control" placeholder="..企业编号" value="${enterprise.code}" />
							</div>
						    <span id="error_code" style="color: red"></span>
						</div>
						<div class="form-group">
						    <label for="name" class="col-sm-3 control-label">备注信息：</label>
							<div class="col-sm-4">
								<textarea id="note"  name="note" class="form-control" placeholder="..备注信息" >${enterprise.note}</textarea>
							</div>
						    <span id="error_note" style="color: red"></span>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-5 col-sm-12">
								<input type="submit" class="btn btn-primary" value="保存" />&nbsp;&nbsp;&nbsp;&nbsp;
								<a href="#" class="btn btn-success " onclick="goback()">返回</a>
							</div>
						</div>
					</form>
				</div>
		    </div>
		</div> <!-- class:row -->
	</div>
</div>
<script type="text/javascript">
	$(function(){
		$("#enterpriseInfo").validate({
		    onkeyup: false,
			rules: {
				name:{
					required:true,
					rangelength:[2,20],
					isContainsSpecialChar:true,
				    remote:{
						url:"${pageContext.request.contextPath}/subsidiary/info/checkEnterpriseName",
						type: "post",
					    dataType: "json",
					    data: {
					    	name: function() {
					            return $("#name").val();
					        },
						    id:$("#strId").val()
					    },
					}
				},
				typeId:{
					min:1
				},
				tel:{
					isPhone: true
				},
				fax:{
					isPhone: true
				},
				postcode:{
					isZipCode:true
				},
				website:{
					url:true
				},
				email:{
					email:true
				},
				code:{
					isContainsSpecialChar:true,
					remote:{
						url:"${pageContext.request.contextPath}/subsidiary/info/checkEnterpriseCode",
						type: "post",
					    dataType: "json",
					    data: {
					    	code: function() {
					            return $("#code").val();
					        },
						    id:$("#strId").val()
					    }
					}
				},
				note:{
					rangelength:[0,120],
				},
				fid:{
					min:1,
					required:true
				}
			},
			messages:{
				name:{
					required:"请输入企业名称",
					rangelength:"企业名称长度为2~20个字符",
					isContainsSpecialChar:"企业名称只能由中文、英文",
				    remote:"该企业名称已存在！"
				},
				typeId:{
					min:"企业类型不能为空"
				},
				tel:{
					isPhone: "请输入正确的座机号码"
				},
				fax:{
					isPhone: "请输入正确的传真号码"
				},
	            postcode:{
	            	isZipCode:"请输入正确的邮政编码"
				},
				website:{
					url:"请输入正确的网址"
				},
				email:{
					email:"请输入正确的电子邮箱"
				},
				code:{
					isContainsSpecialChar:"企业编号只能由英文、数字、“_”组成"
				},
				note:{
					rangelength:"最多可输入125个汉字"
				},
				fid:{
					min:"上级企业不能为空",
					required:"请选择上级企业"
				}
			},
			errorPlacement: function(error, element) {
				error.appendTo(element.parent().siblings("span"));
			},
			submitHandler:function(){
				$.ajax({
					 type:"POST",
					 url:"${pageContext.request.contextPath}/subsidiary/info/saveOrUpdateEnterprise",
					 data:$("#enterpriseInfo").serialize(),
					 success:function(msg){
						 if(msg){
							 alert("保存企业信息成功");
							 goback();
						 }else{
							 alert("保存企业信息失败");
						 }
					 },
					 error: function () {
			        	alert("保存企业信息失败");
			    	}	
				});
			}
		});
	});
	
	//返回
	function goback(){
		window.location.href = "${pageContext.request.contextPath}/subsidiary/info/enterpriseInfoList"
	}
</script>