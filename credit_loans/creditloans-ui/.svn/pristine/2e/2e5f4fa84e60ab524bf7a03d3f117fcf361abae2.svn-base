<%@ page language="java" contentType="text/html; charset=utf-8"
    pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ include  file="./../../../common/header.jsp"%>  

<!-- 二级菜单 begin -->
		<div class="sidebar" id="sidebar">
			<div class="sidebar-shortcuts" id="sidebar-shortcuts">
				<div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
					<div class="icon-text"> <i class="icon-truck"></i> <span> 车辆管理 </span></div>
				</div>
			</div>
			<!-- #sidebar-shortcuts -->
			<ul class="nav nav-list">
				<li> <a href="${pageContext.request.contextPath}/ev/manufacturer/showList"> <i class="icon-home"></i> <span class="menu-text">生产厂家 </span> </a> </li>
				<li> <a href="${pageContext.request.contextPath}/notFount"> <i class="icon-flag"></i> <span class="menu-text">车队信息 </span> </a> </li>
				<li> <a href="${pageContext.request.contextPath}/ev/driver/showList"> <i class="icon-user"></i> <span class="menu-text">驾驶员信息 </span> </a> </li>
				<li class="active"> <a href="${pageContext.request.contextPath}/enterprise/bus/stop/busStopList"> <i class="icon-map-marker"></i> <span class="menu-text">公交站点管理</span> </a> </li>
				<li> <a href="${pageContext.request.contextPath}/enterprise/bus/line/busLineList"> <i class="icon-road"></i> <span class="menu-text">公交线路管理</span> </a> </li>
				<li> <a href="${pageContext.request.contextPath}/ev/vehicle/showList"> <i class="icon-truck"></i> <span class="menu-text">车辆信息 </span> </a> </li>
			</ul>
			<!-- /.nav-list -->
			<div class="sidebar-collapse" id="sidebar-collapse"> <i class="icon-double-angle-left" data-icon1="icon-double-angle-left" data-icon2="icon-double-angle-right"></i> </div>
		</div>
		<!-- 二级菜单 end -->
	<div class="main-content">
		<div class="breadcrumbs" id="breadcrumbs">
			<ul class="breadcrumb">
				<li><i class="icon-home home-icon"></i> <a href="#">首页</a></li>
				<li><a href="#">企业管理</a></li>
				<li class="active">企业信息</li>
			</ul>
		</div>
		
		<div class="page-content">
			<div class="page-header">
				<h1>
					企业信息<small> <i class="icon-double-angle-right"></i>
						设置企业信息
					</small>
				</h1>
			</div><!-- /.page-header -->
			<div class="row">
				<div class="col-xs-12">
			    	<div class="col-md-12">
			    	    <form id="busStopForm" class="form-horizontal" >
			    	       <div class="col-sm-offset-10" style="margin-bottom: 10px;">
						       <a href="#" class="btn btn-primary  icon-plus" onclick="addBusStop()" >新增站点信息</a>
						   </div>
					       <div class="form-group">
							    <label for="name" class="col-sm-1 control-label">站点名称：</label>
								<div class="col-sm-3">
									<input id="busStopName0" name="busStops[0].busStopName" type="text" data-rule-required="true" data-msg-required="*站点不能为空" 
									 data-rule-isContainsSpecialChar="true"  class="form-control" placeholder="..站点名称" />
									<label id="error-busStopName0"  class="error" for="busStopName0" style="color: red;"></label> 
								</div>
							    <label for="name" class="col-sm-1 control-label">经度：</label>
								<div class="col-sm-3">
									<input id="longtitude" name="busStops[0].longtitude" data-rule-required="true" data-msg-required="*经度不能为空"  
									 data-rule-isFloat="true" data-msg-isFloat="请输入浮点型数据" type="text" class="form-control" placeholder="..经度名称" />
									<label id="longtitude-error" class="error" for="longtitude" style="color: red;"></label>
								</div>
							    <label for="name" class="col-sm-1 control-label">纬度：</label>
								<div class="col-sm-3">
									<input id="latitude" name="busStops[0].latitude"  data-rule-required="true" data-msg-required="*纬度不能为空" 
									 data-rule-isFloat="true" data-msg-isFloat="请输入浮点型数据" type="text" class="form-control" placeholder="..纬度名称" />
									<label id="latitude-error" class="error" for="latitude" style="color: red"></label>
								</div>
							</div>
							<div class="col-sm-offset-5" id="insert-input-group">
								<input type="submit" class="btn btn-primary" value="保存" />&nbsp;&nbsp;&nbsp;&nbsp;
								<a href="#" class="btn btn-success " onclick="goback()">返回</a>
								<input type="hidden" id="isRight" value="false"/>
					       </div>
						</form>
			    	</div>
			    </div>	
			</div> <!-- class:row -->
		</div><!-- /.page-content -->
	</div><!-- /.main-content --> 
<%@ include  file="./../../../common/footer.jsp"%>
<script type="text/javascript">
	$(function(){
		 $("#busStopForm").validate({  
			 submitHandler: function(form) 
			   {  
			     $.ajax({
			    	  type:"POST",
			    	   url:"${pageContext.request.contextPath}/enterprise/bus/stop/savBusStopList",
			    	   data:$("#busStopForm").serialize(),
			    	   success:function(msg){
			    		   if(msg){
			    			   alert("保存数据成功");
			    			   goback();
			    		   }else{
			    			   alert("保存数据失败");
			    		   }
			    	   }
			      });
			   }  
			 })	 
	});

	function goback(){
		window.location.href = "${pageContext.request.contextPath}/enterprise/bus/stop/busStopList";
	}
	
	function addBusStop(){
	    var formGroupSize = $("#busStopForm div[class=form-group]").size();
	    if(formGroupSize >= 10){
	    	alert("批量输入的信息最大10条");
	    	return;
	    }
	    var strHtml = "<div class='form-group'>"+
	    			      "<label for='name' class='col-sm-1 control-label'>站点名称：</label>"+
	    			      "<div class='col-sm-3'>"+
					          "<input id='busStops["+formGroupSize+"].busStopName' name='busStops["+formGroupSize+"].busStopName' type='text' class='form-control'"+
					          " data-rule-required='true' data-msg-required='*站点不能为空'  placeholder='..站点名称'/>"+
					          "<label  class='error' id='error-busStopName"+formGroupSize+"'+  for='busStops["+formGroupSize+"].busStopName' style='color: red;''></label>"+
					      "</div>"+
					      "<label for='name' class='col-sm-1 control-label'>经度：</label>"+
					      "<div class='col-sm-3'>"+
					          "<input id='busStops["+formGroupSize+"].longtitude' name='busStops["+formGroupSize+"].longtitude' type='text' class='form-control' "+
					          " data-rule-required='true' data-msg-required='*经度不能为空'  data-rule-isFloat='true' data-msg-isFloat='请输入浮点型数据'  placeholder='..经度名称'/>"+
					          "<label class='error' for='busStops["+formGroupSize+"].longtitude' style='color: red;''></label>"+	
					      "</div>"+
					      "<label for='name' class='col-sm-1 control-label'>纬度：</label>"+
					      "<div class='col-sm-3'>"+
					          "<input id='busStops["+formGroupSize+"].latitude' name='busStops["+formGroupSize+"].latitude' type='text' class='form-control' "+
					          " data-rule-required='true' data-msg-required='*纬度不能为空'  data-rule-isFloat='true' data-msg-isFloat='请输入浮点型数据' placeholder='..纬度名称'/>"+
					          "<label class='error' for='busStops["+formGroupSize+"].latitude' style='color: red;''></label>"+	
					      "</div>"+
	  				  "</div >";
	    $("#insert-input-group").before(strHtml)
	}
	//重名验证
	function checkBusStopName(){
		 var formGroupSize = $("#busStopForm div[class=form-group]").size();
		 for(var index = 0; index < formGroupSize; index++){
			 var busStopName = $("#busStopName"+index).val();
			 $.ajax({
				 type:"POST",
				  url:"${pageContext.request.contextPath}/enterprise/bus/stop/checkBusStopName",
				  data:{"name":busStopName,"strId":0},
				  success:function(msg){
					  $("#error-busStopName0").text("*站点信息不能重复");
					  $("#isRight").val(msg);
				  }
			 });		 
		 }
	}
	
	function formSubmit(){
		/* checkBusStopName();
		var isRight = $("#isRight").val();
		if(isRight == "true"){
			 $("#busStopForm").submit();
		} */
	}
</script>